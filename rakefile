require 'albacore'

NUNIT_EXE = "c:/nunit/bin/net-2.0/nunit-console.exe"
CONFIG = "Release"

task :default => ["build:all"]

namespace :build do

    task :all => [:compile, :test, :nunit]

    desc "Build solution using MSBuild."
    msbuild :compile do |msbuild|
        msbuild.solution = FileList["*.sln"][0]
	msbuild.properties = { :configuration => CONFIG, :logfile => "msbuild.log" }
	msbuild.targets = :clean, :build
	msbuild.verbosity = "normal"
        msbuild.log_level = :verbose
    end

    task :test => [:compile] do
        tests = FileList["**/bin/*#{CONFIG}/*Test*.dll"].exclude(/obj\//)
        sh "#{NUNIT_EXE} #{tests} /nologo /xml=TestResults.xml"
    end

    desc "NUnit Tests"
    nunit do |nunit|
        nunit.path_to_command = NUNIT_EXE 
        nunit.assemblies = FileList["**/bin/*#{CONFIG}/*Test*.dll"].exclude(/obj\//)
    end

end

